[
  {
    "id": "fef6f8de-46df-4f6a-8da8-548aa861f610",
    "name": "æ•°æ®æå–",
    "icon": "el-icon-document-copy",
    "description": "ä»excelæ–‡ä»¶ä¸­æå–æ•°æ®",
    "category_id": "data_operation",
    "python_script": "import openpyxl\nfrom openpyxl.styles import Font, Border, PatternFill, Alignment\nfrom openpyxl.utils import column_index_from_string, get_column_letter\nfrom openpyxl.worksheet.worksheet import Worksheet\nimport os\nimport re\nfrom openpyxl.styles.colors import COLOR_INDEX\n\n# ========== è¾…åŠ©å‡½æ•°ï¼šé¢œè‰²è§£æ ==========\ndef _theme_and_tint_to_rgb(theme, tint, workbook):\n    \"\"\"å°† Excel ä¸»é¢˜è‰² + è‰²è°ƒè½¬æ¢ä¸º ARGB å­—ç¬¦ä¸²ï¼ˆå¦‚ 'FF00FF00'ï¼‰\"\"\"\n    try:\n        clr_scheme = workbook.theme.themeElements.clrScheme\n        # æ˜ å°„ theme ç´¢å¼•åˆ° clrScheme å±æ€§\n        theme_colors = [\n            clr_scheme.lt1.val,   # 0: Light 1 (usually white)\n            clr_scheme.dk1.val,   # 1: Dark 1 (usually black)\n            clr_scheme.lt2.val,   # 2: Light 2\n            clr_scheme.dk2.val,   # 3: Dark 2\n            clr_scheme.accent1.val,\n            clr_scheme.accent2.val,\n            clr_scheme.accent3.val,\n            clr_scheme.accent4.val,\n            clr_scheme.accent5.val,\n            clr_scheme.accent6.val,\n        ]\n        if theme < len(theme_colors):\n            base_rgb = theme_colors[theme]\n        else:\n            return None\n\n        # éªŒè¯ base_rgb æ˜¯ 6 ä½åå…­è¿›åˆ¶\n        if not base_rgb or not re.match(r'^[0-9A-Fa-f]{6}$', base_rgb):\n            return None\n\n        # åº”ç”¨ tintï¼ˆè‰²è°ƒè°ƒæ•´ï¼‰\n        def apply_tint(rgb_hex, tint_value):\n            r = int(rgb_hex[0:2], 16)\n            g = int(rgb_hex[2:4], 16)\n            b = int(rgb_hex[4:6], 16)\n\n            if tint_value < 0:\n                # Darken\n                r = int(r * (1 + tint_value))\n                g = int(g * (1 + tint_value))\n                b = int(b * (1 + tint_value))\n            else:\n                # Lighten\n                r = int(r * (1 - tint_value) + 255 * tint_value)\n                g = int(g * (1 - tint_value) + 255 * tint_value)\n                b = int(b * (1 - tint_value) + 255 * tint_value)\n\n            r = max(0, min(255, r))\n            g = max(0, min(255, g))\n            b = max(0, min(255, b))\n            return f\"{r:02X}{g:02X}{b:02X}\"\n\n        rgb = apply_tint(base_rgb, tint)\n        return f\"FF{rgb}\".upper()  # Alpha=FF (ä¸é€æ˜)\n    except Exception:\n        return None\n\n\ndef _get_rgb_color(color_obj, workbook=None):\n    \"\"\"å®‰å…¨è·å–é¢œè‰²çš„ ARGB å­—ç¬¦ä¸²è¡¨ç¤º\"\"\"\n    if color_obj is None:\n        return None\n\n    if hasattr(color_obj, 'type'):\n        if color_obj.type == 'rgb' and color_obj.rgb:\n            return color_obj.rgb  # already like 'FF0000FF'\n        elif color_obj.type == 'theme' and workbook is not None:\n            tint = getattr(color_obj, 'tint', 0.0)\n            return _theme_and_tint_to_rgb(color_obj.theme, tint, workbook)\n        elif color_obj.type == 'indexed':\n            idx = color_obj.indexed\n            if isinstance(idx, int) and 0 <= idx < len(COLOR_INDEX):\n                val = COLOR_INDEX[idx]\n                if val and isinstance(val, str) and len(val) == 6:\n                    return f\"FF{val}\".upper()\n    return None\n\n\n# ========== ä¸»å‡½æ•° ==========\ndef read_excel_range(\n    datasPath: str = None,\n    sheetName: str = None,\n    startRow: int = None,\n    endRow: int = None,\n    startColumn: str = None,\n    endColumn: str = None\n):\n    \"\"\"\n    è¯»å– Excel æŒ‡å®šåŒºåŸŸå•å…ƒæ ¼çš„æ•°æ®å’Œæ ·å¼ï¼ˆå«æ­£ç¡®è§£æçš„èƒŒæ™¯è‰²ï¼‰ã€‚\n\n    å‚æ•°:\n        datasPath (str, optional): Excel æ–‡ä»¶è·¯å¾„ã€‚é»˜è®¤ä¸º Noneã€‚\n        sheetName (str, optional): å·¥ä½œè¡¨åç§°ã€‚é»˜è®¤ä¸º None (è¯»å–æ´»åŠ¨å·¥ä½œè¡¨æˆ–ç¬¬ä¸€ä¸ªå·¥ä½œè¡¨)ã€‚\n        startRow (int, optional): èµ·å§‹è¡Œå· (1-based)ã€‚é»˜è®¤ä¸º None (ä»ç¬¬ä¸€è¡Œå¼€å§‹)ã€‚\n        endRow (int, optional): ç»“æŸè¡Œå· (1-based)ã€‚é»˜è®¤ä¸º None (åˆ°æœ€åä¸€è¡Œç»“æŸ)ã€‚\n        startColumn (str, optional): èµ·å§‹åˆ—å· (å­—æ¯, e.g., 'A')ã€‚é»˜è®¤ä¸º None (ä»ç¬¬ä¸€åˆ—å¼€å§‹)ã€‚\n        endColumn (str, optional): ç»“æŸåˆ—å· (å­—æ¯, e.g., 'Z')ã€‚é»˜è®¤ä¸º None (åˆ°æœ€åä¸€åˆ—ç»“æŸ)ã€‚\n\n    è¿”å›:\n        list: åŒ…å«å•å…ƒæ ¼ä¿¡æ¯çš„åˆ—è¡¨ï¼Œæ¯ä¸ªå•å…ƒæ ¼ä¿¡æ¯æ˜¯ä¸€ä¸ªå­—å…¸ï¼Œ\n              åŒ…å« 'value', 'font', 'border', 'fill', 'alignment' ç­‰é”®ã€‚\n              å¦‚æœå‘ç”Ÿé”™è¯¯ï¼Œåˆ™è¿”å› Noneã€‚\n    \"\"\"\n    if not datasPath:\n        print(\"é”™è¯¯: å¿…é¡»æä¾› datasPath å‚æ•°ã€‚\")\n        return None\n\n    if not os.path.exists(datasPath):\n        print(f\"é”™è¯¯: æ–‡ä»¶è·¯å¾„ '{datasPath}' ä¸å­˜åœ¨ã€‚\")\n        return None\n\n    try:\n        workbook = openpyxl.load_workbook(datasPath, data_only=True)\n    except Exception as e:\n        print(f\"é”™è¯¯: æ— æ³•åŠ è½½å·¥ä½œç°¿ '{datasPath}'ã€‚åŸå› : {e}\")\n        return None\n\n    # è·å–å·¥ä½œè¡¨\n    worksheet = None\n    if sheetName:\n        if sheetName in workbook.sheetnames:\n            worksheet = workbook[sheetName]\n        else:\n            print(f\"è­¦å‘Š: å·¥ä½œè¡¨ '{sheetName}' æœªæ‰¾åˆ°ï¼Œå°†ä½¿ç”¨æ´»åŠ¨å·¥ä½œè¡¨æˆ–ç¬¬ä¸€ä¸ªå·¥ä½œè¡¨ã€‚\")\n\n    if worksheet is None:\n        worksheet = workbook.active if workbook.active else (workbook.worksheets[0] if workbook.worksheets else None)\n        if worksheet is None:\n            print(\"é”™è¯¯: å·¥ä½œç°¿ä¸­æ²¡æœ‰å¯ç”¨çš„å·¥ä½œè¡¨ã€‚\")\n            return None\n        else:\n            print(f\"ä¿¡æ¯: ä½¿ç”¨å·¥ä½œè¡¨ '{worksheet.title}'.\")\n\n    # è·å–å®é™…ç»´åº¦\n    max_row = worksheet.max_row\n    max_column = worksheet.max_column\n\n    # å¤„ç†é»˜è®¤å€¼\n    startRow = max(1, startRow or 1)\n    endRow = min(max_row, endRow or max_row)\n\n    def safe_col_index(col_str):\n        if col_str is None:\n            return 1\n        try:\n            return column_index_from_string(col_str.upper())\n        except:\n            print(f\"è­¦å‘Š: åˆ—å· '{col_str}' æ— æ•ˆï¼Œå°†ä½¿ç”¨é»˜è®¤åˆ—ã€‚\")\n            return 1\n\n    startColIndex = max(1, safe_col_index(startColumn))\n    endColIndex = min(max_column, safe_col_index(endColumn) if endColumn else max_column)\n\n    if startRow > endRow or startColIndex > endColIndex:\n        print(\"è­¦å‘Š: æŒ‡å®šçš„èŒƒå›´æ— æ•ˆ (èµ·å§‹ä½ç½®å¤§äºç»“æŸä½ç½®)ï¼Œå°†è¿”å›ç©ºåˆ—è¡¨ã€‚\")\n        return []\n\n    print(f\"ä¿¡æ¯: æ­£åœ¨è¯»å–èŒƒå›´ {get_column_letter(startColIndex)}{startRow}:{get_column_letter(endColIndex)}{endRow}...\")\n\n    result_data = []\n\n    for row in range(startRow, endRow + 1):\n        row_data = []\n        for col in range(startColIndex, endColIndex + 1):\n            cell = worksheet.cell(row=row, column=col)\n\n            # æå–å­—ä½“é¢œè‰²ï¼ˆå¯é€‰æ‰©å±•ï¼‰\n            font_color_rgb = _get_rgb_color(cell.font.color, workbook) if cell.font else None\n\n            cell_info = {\n                \"coordinate\": cell.coordinate,\n                \"value\": cell.value,\n                \"font\": {\n                    \"name\": cell.font.name if cell.font else None,\n                    \"sz\": cell.font.sz if cell.font else None,\n                    \"colorRGB\": font_color_rgb,\n                    \"b\": cell.font.b if cell.font else None,\n                    \"i\": cell.font.i if cell.font else None,  # italic\n                    \"u\": cell.font.u if cell.font else None,  # underline\n                },\n                \"border\": {\n                    \"left\": {\n                        \"style\": cell.border.left.style if cell.border and cell.border.left else None,\n                        \"colorRGB\": _get_rgb_color(cell.border.left.color, workbook) if cell.border and cell.border.left else None,\n                    },\n                    \"right\": {\n                        \"style\": cell.border.right.style if cell.border and cell.border.right else None,\n                        \"colorRGB\": _get_rgb_color(cell.border.right.color, workbook) if cell.border and cell.border.right else None,\n                    },\n                    \"top\": {\n                        \"style\": cell.border.top.style if cell.border and cell.border.top else None,\n                        \"colorRGB\": _get_rgb_color(cell.border.top.color, workbook) if cell.border and cell.border.top else None,\n                    },\n                    \"bottom\": {\n                        \"style\": cell.border.bottom.style if cell.border and cell.border.bottom else None,\n                        \"colorRGB\": _get_rgb_color(cell.border.bottom.color, workbook) if cell.border and cell.border.bottom else None,\n                    },\n                },\n                \"fill\": {\n                    \"patternType\": cell.fill.patternType if cell.fill else None,\n                    \"fgColorRGB\": _get_rgb_color(cell.fill.fgColor, workbook) if cell.fill else None,\n                    \"bgColorRGB\": _get_rgb_color(cell.fill.bgColor, workbook) if cell.fill else None,\n                },\n                \"alignment\": {\n                    \"horizontal\": cell.alignment.horizontal if cell.alignment else None,\n                    \"vertical\": cell.alignment.vertical if cell.alignment else None,\n                    \"wrap_text\": cell.alignment.wrapText if cell.alignment else None,\n                    \"text_rotation\": cell.alignment.textRotation if cell.alignment else None,\n                }\n            }\n            row_data.append(cell_info)\n        result_data.append(row_data)\n\n    return result_data",
    "sort_order": 1,
    "is_active": true,
    "created_at": "2025-09-23T14:11:57.659825",
    "updated_at": "2025-11-12T15:02:17.189235",
    "params": [
      {
        "name": "datasPath",
        "label": "æ•°æ®æºæ–‡ä»¶",
        "description": "",
        "type": "string",
        "required": true,
        "defaultValue": "",
        "direction": 0,
        "apiUrl": "http://127.0.0.1:5001/api/datasource/all-options"
      },
      {
        "name": "sheetName",
        "label": "sheetåç§°",
        "description": "",
        "type": "string",
        "required": true,
        "defaultValue": "",
        "direction": 0,
        "apiUrl": ""
      },
      {
        "name": "startRow",
        "label": "èµ·å§‹è¡Œ",
        "description": "",
        "type": "string",
        "required": true,
        "defaultValue": "1",
        "direction": 0,
        "apiUrl": ""
      },
      {
        "name": "endRow",
        "label": "ç»“æŸè¡Œ",
        "description": "",
        "type": "string",
        "required": true,
        "defaultValue": "10",
        "direction": 0,
        "apiUrl": ""
      },
      {
        "name": "startColumn",
        "label": "èµ·å§‹åˆ—",
        "description": "",
        "type": "string",
        "required": true,
        "defaultValue": "A",
        "direction": 0,
        "apiUrl": ""
      },
      {
        "name": "endColumn",
        "label": "ç»“æŸåˆ—",
        "description": "",
        "type": "string",
        "required": true,
        "defaultValue": "D",
        "direction": 0,
        "apiUrl": ""
      },
      {
        "name": "result_variable_name",
        "label": "ç»“æœå˜é‡åç§°",
        "description": "",
        "type": "string",
        "required": true,
        "defaultValue": "data_result",
        "direction": 1,
        "apiUrl": ""
      }
    ]
  },
  {
    "id": "d22d6d99-b929-4cb4-8112-6fa8ca61f9c7",
    "name": "æ•°æ®å†™å…¥",
    "icon": "ğŸ“¤",
    "description": "å°†æ•°æ®å†™å…¥åˆ°ç›®æ ‡ä½ç½®",
    "category_id": "data_operation",
    "python_script": "import openpyxl\nfrom openpyxl.styles import Font, Border, Side, PatternFill, Alignment, Color\nfrom openpyxl.utils import get_column_letter, column_index_from_string\nimport os\nimport json\nimport sys\nimport os\nimport re\nfrom openpyxl import load_workbook\n\ndef _sanitize_sheet_name(name: str, existing_names) -> str:\n    name = str(name).strip() if name else \"\"\n    name = re.sub(r'[^\\u4e00-\\u9fa5a-zA-Z0-9]', '_', name)\n    name = name[:31].rstrip('_') or \"Sheet\"\n    candidate = name\n    counter = 1\n    while candidate in existing_names:\n        suffix = f\" ({counter})\"\n        base = name[:31 - len(suffix)]\n        candidate = base + suffix\n        counter += 1\n    print(f\"æœ€ç»ˆå·¥ä½œè¡¨å: {candidate}\")\n    return candidate\n\ndef safe_write_excel_range(data, target_path:str, sheet_name:str=None, startrow:int=1, startcol:str='A', with_style:bool=True):\n    \"\"\"\n    å°†æ•°æ®å†™å…¥ Excelï¼Œæ”¯æŒæ ·å¼è¿˜åŸï¼ˆä¼˜åŒ–ç‰ˆï¼‰ã€‚\n    \n    åŠŸèƒ½æ”¹è¿›ï¼š\n    1. ä¼˜å…ˆä½¿ç”¨ast.literal_evalä½œä¸ºä¸»è¦è§£æå¼•æ“ï¼Œæä¾›æœ€ä½³çš„Pythonè¯­æ³•å…¼å®¹æ€§\n    2. ç§»é™¤é‡å¤çš„å·¥ä½œç°¿ä¿å­˜ä»£ç \n    3. æ­£ç¡®å¤„ç†Unicodeå­—ç¬¦å’Œæ¢è¡Œç¬¦\n    4. ä¿®å¤å¡«å……é¢œè‰²è®¾ç½®é€»è¾‘\n    5. å¢å¼ºæ•°æ®ç±»å‹å¤„ç†ï¼Œæ”¯æŒPythonæ ¼å¼å’ŒJavaScriptæ ¼å¼çš„å€¼\n    6. æ”¹è¿›JSONå­—ç¬¦ä¸²è§£æé€»è¾‘ï¼Œå¤„ç†å„ç§æ ¼å¼çš„è¾“å…¥å­—ç¬¦ä¸²\n    \"\"\"\n    data_obj = None\n    \n    try:\n        # å°è¯•å°†dataè§£æä¸ºJSONå¯¹è±¡\n        if isinstance(data, str):\n            # ä¼˜å…ˆä½¿ç”¨ast.literal_evalï¼ˆæ›´å¼ºçš„Pythonè¯­æ³•å…¼å®¹æ€§ï¼‰\n            try:\n                import ast\n                print(\"ä¿¡æ¯: ä¼˜å…ˆå°è¯•ä½¿ç”¨ast.literal_evalè§£ææ•°æ®...\")\n                data_obj = ast.literal_eval(data)\n                print(\"ä¿¡æ¯: æˆåŠŸä½¿ç”¨ast.literal_evalè§£ææ•°æ®\")\n            except (ValueError, SyntaxError) as e0:\n                print(f\"ä¿¡æ¯: ast.literal_evalè§£æå¤±è´¥ï¼Œé”™è¯¯: {e0}ï¼Œå°è¯•jsonè§£æ...\")\n                \n                try:\n                    # å°è¯•ç›´æ¥ä½¿ç”¨json.loads\n                    data_obj = json.loads(data)\n                    print(\"ä¿¡æ¯: æˆåŠŸç›´æ¥è§£æJSONå­—ç¬¦ä¸²\")\n                except json.JSONDecodeError as e1:\n                    print(f\"ä¿¡æ¯: ç›´æ¥è§£æå¤±è´¥ï¼Œå°è¯•é¢„å¤„ç†åè§£æã€‚ç¬¬ä¸€æ¬¡é”™è¯¯: {e1}\")\n                    \n                    # é¢„å¤„ç†1: å¤„ç†å­—ç¬¦ä¸²ä¸­çš„Pythonæ ¼å¼å€¼ï¼ˆNone/True/Falseï¼‰\n                    # æ³¨æ„ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼çš„æ€æƒ³ï¼Œä½†ç”¨æ›´å®‰å…¨çš„å­—ç¬¦ä¸²æ›¿æ¢é¡ºåº\n                    processed_data = data\n                    \n                    # å…ˆå¤„ç†ç‰¹æ®Šæƒ…å†µï¼Œç¡®ä¿ä¸ä¼šé”™è¯¯æ›¿æ¢\n                    # ç¡®ä¿åªæ›¿æ¢å®Œæ•´çš„å•è¯ï¼Œè€Œä¸æ˜¯éƒ¨åˆ†å•è¯\n                    # æ›¿æ¢None\n                    processed_data = processed_data.replace(' None,', ' null,').replace(' None}', ' null}')\n                    processed_data = processed_data.replace(': None,', ': null,').replace(': None}', ': null}')\n                    processed_data = processed_data.replace('\"None\"', 'null')\n                    \n                    # æ›¿æ¢True\n                    processed_data = processed_data.replace(' True,', ' true,').replace(' True}', ' true}')\n                    processed_data = processed_data.replace(': True,', ': true,').replace(': True}', ': true}')\n                    processed_data = processed_data.replace('\"True\"', 'true')\n                    \n                    # æ›¿æ¢False\n                    processed_data = processed_data.replace(' False,', ' false,').replace(' False}', ' false}')\n                    processed_data = processed_data.replace(': False,', ': false,').replace(': False}', ': false}')\n                    processed_data = processed_data.replace('\"False\"', 'false')\n                    \n                    # é¢„å¤„ç†2: å¤„ç†å¯èƒ½çš„å•å¼•å·é—®é¢˜\n                    if processed_data.count(\"'\") > processed_data.count('\"'):\n                        print(\"ä¿¡æ¯: æ£€æµ‹åˆ°å¯èƒ½çš„å•å¼•å·JSONæ ¼å¼ï¼Œå°è¯•è½¬æ¢\")\n                        # æ›¿æ¢é”®åçš„å•å¼•å·ä¸ºåŒå¼•å·ï¼Œä½†ä¿ç•™å­—ç¬¦ä¸²å€¼ä¸­çš„å•å¼•å·\n                        # è¿™æ˜¯ä¸€ä¸ªç®€åŒ–å¤„ç†ï¼Œåœ¨å®é™…å¤æ‚æƒ…å†µä¸‹å¯èƒ½éœ€è¦æ›´å¤æ‚çš„è§£æ\n                        temp_data = \"\"\n                        in_string = False\n                        last_char = \"\"\n                        for char in processed_data:\n                            if char == '\"' and last_char != '\\\\':\n                                in_string = not in_string\n                            elif char == \"'\" and not in_string:\n                                temp_data += '\"'\n                            else:\n                                temp_data += char\n                            last_char = char\n                        processed_data = temp_data\n                    \n                    # å°è¯•è§£æé¢„å¤„ç†åçš„æ•°æ®\n                    try:\n                        data_obj = json.loads(processed_data)\n                        print(\"ä¿¡æ¯: é¢„å¤„ç†åæˆåŠŸè§£æJSONå­—ç¬¦ä¸²\")\n                    except json.JSONDecodeError as e2:\n                        print(f\"é”™è¯¯: é¢„å¤„ç†åä»æ— æ³•è§£æè¾“å…¥æ•°æ®ä¸ºJSONå¯¹è±¡ã€‚ç¬¬äºŒæ¬¡é”™è¯¯: {e2}\")\n                        print(f\"å‰200å­—ç¬¦çš„åŸå§‹æ•°æ®: {data[:200]}...\")\n                        print(f\"å‰200å­—ç¬¦çš„å¤„ç†åæ•°æ®: {processed_data[:200]}...\")\n                        return\n        else:\n            # å¦‚æœdataå·²ç»æ˜¯å¯¹è±¡ï¼Œç›´æ¥ä½¿ç”¨\n            data_obj = data\n            print(\"ä¿¡æ¯: è¾“å…¥å·²æ˜¯å¯¹è±¡ç±»å‹ï¼Œç›´æ¥ä½¿ç”¨\")\n    except Exception as e:\n        print(f\"é”™è¯¯: å¤„ç†æ•°æ®æ—¶å‘ç”Ÿå¼‚å¸¸: {e}\")\n        import traceback\n        traceback.print_exc()\n        return\n    \n    if data_obj is None:\n        print(\"é”™è¯¯: æ— æ³•è§£æè¾“å…¥æ•°æ®\")\n        return\n\n    if not data_obj:\n        print(\"è­¦å‘Š: è¾“å…¥æ•°æ®ä¸ºç©ºï¼Œæ²¡æœ‰å†…å®¹å¯å†™å…¥ã€‚\")\n        # ä»ç»§ç»­åˆ›å»º/ä¿å­˜ç©ºæ–‡ä»¶\n\n    # --- å‚æ•°æ ¡éªŒ ---\n    try:\n        startrow = int(startrow)\n    except ValueError:\n        print(f\"é”™è¯¯: startrow å¿…é¡»æ˜¯æ•´æ•°ï¼Œæ”¶åˆ°: {startrow}\")\n        return\n        \n    if not isinstance(startrow, int) or startrow < 1:\n        raise ValueError(\"startrow å¿…é¡»æ˜¯å¤§äºç­‰äº1çš„æ•´æ•°ã€‚\")\n    if not isinstance(startcol, str):\n        raise ValueError(\"startcol å¿…é¡»æ˜¯å­—ç¬¦ä¸²å½¢å¼çš„Excelåˆ—å­—æ¯ã€‚\")\n    try:\n        startcol_index = column_index_from_string(startcol.upper())\n    except Exception as e:\n        raise ValueError(f\"æ— æ•ˆçš„Excelåˆ—å­—æ¯ '{startcol}': {e}\")\n\n    # --- æ‰“å¼€æˆ–åˆ›å»ºå·¥ä½œç°¿ ---\n    try:\n        if os.path.exists(target_path):\n            try:\n                workbook = openpyxl.load_workbook(target_path)\n                print(f\"ä¿¡æ¯: å·²åŠ è½½ç°æœ‰å·¥ä½œç°¿ '{target_path}'ã€‚\")\n            except Exception as e:\n                print(f\"é”™è¯¯: æ— æ³•åŠ è½½ç°æœ‰å·¥ä½œç°¿ '{target_path}'ã€‚åŸå› : {e}\")\n                # å°è¯•åˆ›å»ºæ–°å·¥ä½œç°¿æ›¿ä»£\n                workbook = openpyxl.Workbook()\n                print(f\"ä¿¡æ¯: åˆ›å»ºäº†æ–°çš„å·¥ä½œç°¿æ›¿ä»£ã€‚\")\n        else:\n            workbook = openpyxl.Workbook()\n            print(f\"ä¿¡æ¯: åˆ›å»ºäº†æ–°çš„å·¥ä½œç°¿ '{target_path}'ã€‚\")\n    except Exception as e:\n        print(f\"é”™è¯¯: åˆ›å»ºæˆ–æ‰“å¼€å·¥ä½œç°¿æ—¶å‘ç”Ÿå¼‚å¸¸: {e}\")\n        return\n    # sheetåç§°å»æ‰éæ³•å­—ç¬¦\n    existing = workbook.sheetnames\n    cleaned_sheet_name = _sanitize_sheet_name(sheet_name, existing)\n    # --- è·å–æˆ–åˆ›å»ºå·¥ä½œè¡¨ ---\n    worksheet = None\n    try:\n        if cleaned_sheet_name:\n            if cleaned_sheet_name in workbook.sheetnames:\n                worksheet = workbook[cleaned_sheet_name]\n                print(f\"ä¿¡æ¯: ä½¿ç”¨ç°æœ‰å·¥ä½œè¡¨ '{cleaned_sheet_name}'ã€‚\")\n            else:\n                worksheet = workbook.create_sheet(title=cleaned_sheet_name)\n                print(f\"ä¿¡æ¯: åˆ›å»ºäº†æ–°å·¥ä½œè¡¨ '{cleaned_sheet_name}'ã€‚\")\n        else:\n            worksheet = workbook.active\n            if worksheet is None:\n                worksheet = workbook.create_sheet(title=\"Sheet1\")\n            print(f\"ä¿¡æ¯: ä½¿ç”¨å·¥ä½œè¡¨ '{worksheet.title}'ã€‚\")\n    except Exception as e:\n        print(f\"é”™è¯¯: è·å–æˆ–åˆ›å»ºå·¥ä½œè¡¨æ—¶å‘ç”Ÿå¼‚å¸¸: {e}\")\n        return\n\n    # --- å†™å…¥æ•°æ®å’Œæ ·å¼ ---\n    num_rows_written = 0\n    num_cols_written = 0\n\n    if data_obj:\n        try:\n            for r_idx, row_data in enumerate(data_obj):\n                target_row = startrow + r_idx\n                num_cols_in_this_row = 0\n\n                for c_idx, cell_info in enumerate(row_data):\n                    target_col_index = startcol_index + c_idx\n                    target_cell = worksheet.cell(row=target_row, column=target_col_index)\n\n                    # --- å†™å…¥å€¼ ---\n                    value = cell_info.get('value')\n                    # ç¡®ä¿æ­£ç¡®å¤„ç†æ¢è¡Œç¬¦å’Œç‰¹æ®Šå­—ç¬¦\n                    if isinstance(value, str):\n                        # ç¡®ä¿å­—ç¬¦ä¸²ä¸­çš„æ¢è¡Œç¬¦è¢«æ­£ç¡®å¤„ç†\n                        value = value.replace('\\\\n', '\\n')\n                    target_cell.value = value\n\n                    if with_style:\n                        # === 1. å­—ä½“ ===\n                        font_data = cell_info.get('font', {})\n                        if font_data:\n                            font_kwargs = {}\n                            if font_data.get('name') is not None:\n                                font_kwargs['name'] = font_data['name']\n                            if font_data.get('sz') is not None:\n                                font_kwargs['size'] = font_data['sz']\n                            if font_data.get('b') is not None:\n                                font_kwargs['bold'] = font_data['b']\n                            if font_data.get('i') is not None:\n                                font_kwargs['italic'] = font_data['i']\n                            if font_data.get('u') is not None:\n                                font_kwargs['underline'] = font_data['u']\n\n                            color_rgb = font_data.get('colorRGB')\n                            if color_rgb and isinstance(color_rgb, str) and len(color_rgb) == 8:\n                                try:\n                                    font_kwargs['color'] = Color(rgb=color_rgb)\n                                except Exception as e:\n                                    print(f\"è­¦å‘Š: è®¾ç½®å­—ä½“é¢œè‰²æ—¶å‡ºé”™: {e}\")\n\n                            if font_kwargs:\n                                try:\n                                    target_cell.font = Font(**font_kwargs)\n                                except Exception as e:\n                                    print(f\"è­¦å‘Š: è®¾ç½®å­—ä½“æ—¶å‡ºé”™: {e}\")\n\n                        # === 2. è¾¹æ¡† ===\n                        border_data = cell_info.get('border', {})\n                        if border_data:\n                            def create_side(side_dict):\n                                style = side_dict.get('style')\n                                color_rgb = side_dict.get('colorRGB')\n                                if not style and not color_rgb:\n                                    return Side()  # é»˜è®¤æ— è¾¹æ¡†\n                                side_kwargs = {}\n                                if style:\n                                    side_kwargs['style'] = style\n                                if color_rgb and isinstance(color_rgb, str) and len(color_rgb) == 8:\n                                    try:\n                                        side_kwargs['color'] = Color(rgb=color_rgb)\n                                    except Exception as e:\n                                        print(f\"è­¦å‘Š: è®¾ç½®è¾¹æ¡†é¢œè‰²æ—¶å‡ºé”™: {e}\")\n                                return Side(**side_kwargs)\n\n                            try:\n                                left = create_side(border_data.get('left', {}))\n                                right = create_side(border_data.get('right', {}))\n                                top = create_side(border_data.get('top', {}))\n                                bottom = create_side(border_data.get('bottom', {}))\n                                target_cell.border = Border(left=left, right=right, top=top, bottom=bottom)\n                            except Exception as e:\n                                print(f\"è­¦å‘Š: è®¾ç½®è¾¹æ¡†æ—¶å‡ºé”™: {e}\")\n\n                        # === 3. å¡«å……ï¼ˆèƒŒæ™¯è‰²ï¼‰- ä¿®å¤ç‰ˆ ===\n                        fill_data = cell_info.get('fill', {})\n                        if fill_data:\n                            pattern_type = fill_data.get('patternType')\n                            fg_color_rgb = fill_data.get('fgColorRGB')\n\n                            # ä¿®å¤å¡«å……é¢œè‰²é€»è¾‘\n                            try:\n                                if fg_color_rgb and fg_color_rgb != '00000000':\n                                    # æœ‰é¢œè‰²æ—¶ï¼Œç¡®ä¿è®¾ç½®patternTypeä¸ºsolid\n                                    pattern_type = pattern_type or 'solid'\n                                    fill_kwargs = {'patternType': pattern_type}\n                                    \n                                    # æ­£ç¡®è®¾ç½®å‰æ™¯è‰²\n                                    if isinstance(fg_color_rgb, str) and len(fg_color_rgb) == 8:\n                                        try:\n                                            # å¯¹äºopenpyxlï¼Œä½¿ç”¨fgColorå±æ€§è®¾ç½®å¡«å……è‰²\n                                            fill_kwargs['fgColor'] = Color(rgb=fg_color_rgb)\n                                            target_cell.fill = PatternFill(**fill_kwargs)\n                                        except Exception as e:\n                                            print(f\"è­¦å‘Š: è®¾ç½®å¡«å……é¢œè‰²æ—¶å‡ºé”™: {e}\")\n                            except Exception as e:\n                                print(f\"è­¦å‘Š: å¤„ç†å¡«å……æ ·å¼æ—¶å‡ºé”™: {e}\")\n\n                        # === 4. å¯¹é½ ===\n                        alignment_data = cell_info.get('alignment', {})\n                        if alignment_data:\n                            align_kwargs = {}\n                            h = alignment_data.get('horizontal')\n                            v = alignment_data.get('vertical')\n                            wrap = alignment_data.get('wrap_text')\n                            rotation = alignment_data.get('text_rotation')\n\n                            if h: align_kwargs['horizontal'] = h\n                            if v: align_kwargs['vertical'] = v\n                            if wrap is not None: align_kwargs['wrap_text'] = wrap\n                            if rotation is not None: align_kwargs['text_rotation'] = rotation\n\n                            if align_kwargs:\n                                try:\n                                    target_cell.alignment = Alignment(**align_kwargs)\n                                except Exception as e:\n                                    print(f\"è­¦å‘Š: è®¾ç½®å¯¹é½æ–¹å¼æ—¶å‡ºé”™: {e}\")\n\n                    num_cols_in_this_row += 1\n\n                num_rows_written += 1\n                if num_cols_in_this_row > num_cols_written:\n                    num_cols_written = num_cols_in_this_row\n\n            style_msg = \"åŠæ ·å¼\" if with_style else \"ï¼ˆä»…æ•°æ®ï¼‰\"\n            print(f\"ä¿¡æ¯: æˆåŠŸå†™å…¥ {num_rows_written} è¡Œï¼Œ{num_cols_written} åˆ—æ•°æ®{style_msg}åˆ° '{target_path}' çš„å·¥ä½œè¡¨ '{worksheet.title}'ï¼Œèµ·å§‹ä½ç½® {startcol}{startrow}ã€‚\")\n\n        except Exception as e:\n            print(f\"é”™è¯¯: åœ¨å†™å…¥æ•°æ®æ—¶å‘ç”Ÿå¼‚å¸¸: {e}\")\n            import traceback\n            traceback.print_exc()\n            return\n\n    # --- ä¿å­˜å·¥ä½œç°¿ï¼ˆåªä¿å­˜ä¸€æ¬¡ï¼Œä¿®å¤é‡å¤ä¿å­˜é—®é¢˜ï¼‰---\n    try:\n        workbook.save(target_path)\n        print(f\"ä¿¡æ¯: å·¥ä½œç°¿å·²æˆåŠŸä¿å­˜åˆ° '{target_path}'ã€‚\")\n        return True\n    except Exception as e:\n        print(f\"é”™è¯¯: æ— æ³•ä¿å­˜å·¥ä½œç°¿åˆ° '{target_path}'ã€‚åŸå› : {e}\")\n        import traceback\n        traceback.print_exc()\n        return False\n",
    "sort_order": 2,
    "is_active": true,
    "created_at": "2025-09-23T14:11:57.659825",
    "updated_at": "2025-11-13T12:42:11.803824",
    "params": [
      {
        "name": "data",
        "label": "å¾…å†™å…¥æ•°æ®",
        "description": "",
        "type": "string",
        "required": true,
        "defaultValue": "",
        "direction": 0,
        "apiUrl": ""
      },
      {
        "name": "target_path",
        "label": "ç›®æ ‡æ–‡ä»¶è·¯å¾„",
        "description": "",
        "type": "string",
        "required": true,
        "defaultValue": "",
        "direction": 0,
        "apiUrl": ""
      },
      {
        "name": "sheet_name",
        "label": "sheetå",
        "description": "",
        "type": "string",
        "required": true,
        "defaultValue": "",
        "direction": 0,
        "apiUrl": ""
      },
      {
        "name": "startrow",
        "label": "ç›®æ ‡å•å…ƒæ ¼èµ·å§‹è¡Œ",
        "description": "",
        "type": "string",
        "required": true,
        "defaultValue": "1",
        "direction": 0,
        "apiUrl": ""
      },
      {
        "name": "startcol",
        "label": "ç›®æ ‡å•å…ƒæ ¼èµ·å§‹åˆ—",
        "description": "",
        "type": "string",
        "required": true,
        "defaultValue": "",
        "direction": 0,
        "apiUrl": ""
      },
      {
        "name": "with_style",
        "label": "æ˜¯å¦å†™å…¥æ ·å¼",
        "description": "",
        "type": "boolean",
        "required": true,
        "defaultValue": "true",
        "direction": 0,
        "apiUrl": ""
      }
    ]
  },
  {
    "id": "e62d6d7d-c9d8-43e3-9bd7-66498a0fb8eb",
    "name": "æ’åº",
    "icon": "ğŸ”¢",
    "description": "å¯¹æ•°æ®è¿›è¡Œæ’åº",
    "category_id": "flow_control",
    "python_script": "# æ•°æ®æ’åºè„šæœ¬\ndef sort_data(data, column_name, ascending=True):\n    \"\"\"å¯¹æ•°æ®è¿›è¡Œæ’åº\"\"\"\n    import pandas as pd\n    return data.sort_values(by=column_name, ascending=ascending)",
    "sort_order": 1,
    "is_active": true,
    "created_at": "2025-09-23T14:11:57.659825",
    "updated_at": "2025-11-10T16:05:50.057342",
    "params": [
      {
        "name": "data",
        "label": "æ•°æ®",
        "description": "",
        "type": "string",
        "required": true,
        "defaultValue": "",
        "direction": 0,
        "apiUrl": ""
      },
      {
        "name": "column_name",
        "label": "åˆ—å",
        "description": "",
        "type": "string",
        "required": true,
        "defaultValue": "",
        "direction": 0,
        "apiUrl": ""
      },
      {
        "name": "ascending",
        "label": "æ˜¯å¦æ­£åº",
        "description": "",
        "type": "boolean",
        "required": true,
        "defaultValue": "false",
        "direction": 0,
        "apiUrl": ""
      }
    ]
  },
  {
    "id": "d0c8d15c-b0b7-4b36-9f03-8c16edbbdb62",
    "name": "æ–°å»ºexcel",
    "icon": "el-icon-document-add",
    "description": "åˆ›å»ºæ–°çš„excelæ–‡ä»¶",
    "category_id": "data_operation",
    "python_script": "import os\nimport pandas as pd\nimport datetime\n\ndef create_excel_file(filename):\n    try:\n        # ç¡®ä¿æ–‡ä»¶åä»¥ .xlsx ç»“å°¾\n        if not filename.lower().endswith('.xlsx'):\n            filename += '.xlsx'\n        time_format=datetime.datetime.now().strftime(\"%Y%m%d%H%M%S\")\n        file_path = os.path.join('config_infos\\\\uploads\\\\tempfiles', f\"{time_format}_{filename}\")\n        \n        # åˆ›å»ºä¸€ä¸ªç©ºçš„ DataFrame æˆ–åŒ…å«é»˜è®¤æ•°æ®\n        df = pd.DataFrame({})\n        \n        # ä¿å­˜ä¸º Excel\n        df.to_excel(file_path, index=False)\n        \n        print(f\"Excel æ–‡ä»¶å·²åˆ›å»ºï¼š{file_path}\")\n        return file_path\n\n    except Exception as e:\n        print(f\"åˆ›å»º Excel æ–‡ä»¶æ—¶å‡ºé”™ï¼š{e}\")\n        return None",
    "sort_order": 3,
    "is_active": true,
    "created_at": "2025-10-21T17:54:56.378894",
    "updated_at": "2025-11-06T15:37:58.905856",
    "params": [
      {
        "name": "filename",
        "label": "æ–‡ä»¶å",
        "description": "",
        "type": "string",
        "required": true,
        "defaultValue": "",
        "direction": 0,
        "apiUrl": ""
      },
      {
        "name": "filepath",
        "label": "æ–‡ä»¶åœ°å€",
        "description": "",
        "type": "string",
        "required": false,
        "defaultValue": "",
        "direction": 1,
        "apiUrl": ""
      }
    ]
  },
  {
    "id": "85a57948-ee58-4bb0-8fd8-62931339a061",
    "name": "æ–‡ä»¶ä¸‹è½½",
    "icon": "el-icon-download",
    "description": "ä¸‹è½½æ–‡ä»¶ï¼Œè¾“å‡ºæ–‡ä»¶æµ",
    "category_id": "flow_control",
    "python_script": "def download_file_to_base64_dict(filepath: str):\n    \"\"\"\n    ä¸‹è½½æ–‡ä»¶ï¼ˆURL æˆ–æœ¬åœ°è·¯å¾„ï¼‰ï¼Œè¿”å›åŒ…å«æ–‡ä»¶åã€Base64 å†…å®¹ã€MIME ç±»å‹ã€å¤§å°çš„å­—å…¸ã€‚\n    ä¾›å‰ç«¯ä½¿ç”¨ã€‚\n    \"\"\"\n    import requests\n    import os\n    from urllib.parse import urlparse\n    import base64\n    import mimetypes\n    try:\n        parsed = urlparse(filepath)\n        file_content = None\n\n        # 1. åˆ¤æ–­æ˜¯ç½‘ç»œæ–‡ä»¶è¿˜æ˜¯æœ¬åœ°æ–‡ä»¶\n        if parsed.scheme in ('http', 'https'):\n            # ç½‘ç»œæ–‡ä»¶\n            response = requests.get(filepath, stream=True, timeout=30)\n            response.raise_for_status()\n            file_content = response.content\n\n        else:\n            # æœ¬åœ°æ–‡ä»¶\n            if not os.path.exists(filepath):\n                raise FileNotFoundError(f\"æœ¬åœ°æ–‡ä»¶ä¸å­˜åœ¨: {filepath}\")\n            if not os.path.isfile(filepath):\n                raise IsADirectoryError(f\"è·¯å¾„ä¸æ˜¯æ–‡ä»¶: {filepath}\")\n            with open(filepath, 'rb') as f:\n                file_content = f.read()\n\n        if not file_content:\n            raise ValueError(\"æ–‡ä»¶å†…å®¹ä¸ºç©º\")\n\n        # 2. æ¨æµ‹æ–‡ä»¶å\n        filename = os.path.basename(filepath)\n        if not filename or '.' not in filename:\n            # ä» URL path æˆ– Content-Disposition å°è¯•è·å–\n            parsed_path = parsed.path\n            if parsed_path and '/' in parsed_path:\n                filename = os.path.basename(parsed_path)\n            if not os.path.splitext(filename)[1]:\n                # ä»ç„¶æ²¡æœ‰æ‰©å±•å\n                filename += '.bin'\n\n        # 3. æ¨æµ‹ MIME ç±»å‹\n        content_type, _ = mimetypes.guess_type(filepath)\n        if content_type is None:\n            content_type = 'application/octet-stream'\n\n        # 4. Base64 ç¼–ç \n        base64_content = base64.b64encode(file_content).decode('utf-8')\n\n        # 5. æ„é€ è¿”å›å­—å…¸\n        result = {\n            \"file_name\": filename,\n            \"file_data\": base64_content,\n            \"content_type\": content_type,\n            \"file_size\": len(file_content)\n        }\n\n        return result\n\n    except Exception as e:\n        print(f\"æ–‡ä»¶å¤„ç†å¤±è´¥: {e}\")\n        return {\n            \"error\": str(e),\n            \"file_name\": None,\n            \"file_data\": None,\n            \"content_type\": None,\n            \"file_size\": 0\n        }",
    "sort_order": 4,
    "is_active": true,
    "created_at": "2025-10-21T18:00:16.568714",
    "updated_at": "2025-11-10T16:06:04.321731",
    "params": [
      {
        "name": "filepath",
        "label": "æ–‡ä»¶åœ°å€",
        "description": "",
        "type": "string",
        "required": true,
        "defaultValue": "",
        "direction": 0,
        "apiUrl": ""
      }
    ]
  },
  {
    "id": "8262be12-683a-45c9-b6d2-381f9bf2984b",
    "name": "è½¬ä¸ºç½‘ç»œåœ°å€",
    "icon": "el-icon-link",
    "description": "å°†æ–‡ä»¶æœ¬åœ°è·¯å¾„è½¬ä¸ºç½‘ç»œåœ°å€",
    "category_id": "flow_control",
    "python_script": "from config import config\nimport urllib.parse\ndef getWebUrl(filepath:str):\n    # ç»Ÿä¸€è½¬æ¢ä¸ºæ­£æ–œæ \n    filepath = filepath.replace('\\\\', '/')\n    # é€šè¿‡urllib.parseæ¨¡å—ç›´æ¥ä½¿ç”¨quoteå‡½æ•°\n    interfaceAddress='/api/file/download_file?filepath='\n    encoded = urllib.parse.quote(str(filepath), safe='')\n    return f\"{config.SCHEME}://{config.HOST}:{config.PORT}{interfaceAddress}{encoded}\"",
    "sort_order": 5,
    "is_active": true,
    "created_at": "2025-11-06T13:26:39.473920",
    "updated_at": "2025-11-10T16:05:05.584068",
    "params": [
      {
        "name": "filepath",
        "label": "æ–‡ä»¶è·¯å¾„",
        "description": "",
        "type": "string",
        "required": true,
        "defaultValue": "",
        "direction": 0,
        "apiUrl": ""
      },
      {
        "name": "weburl",
        "label": "ç½‘ç»œåœ°å€",
        "description": "",
        "type": "string",
        "required": false,
        "defaultValue": "",
        "direction": 1,
        "apiUrl": ""
      }
    ]
  },
  {
    "id": "d15812ec-59bc-437d-9dc2-98dee59404b8",
    "name": "è·å–æ•°æ®æºè·¯å¾„",
    "icon": "el-icon-apple",
    "description": "è·å–æ•°æ®æºè·¯å¾„",
    "category_id": "data_processing",
    "python_script": "def execute(select_source_file):\n    return select_source_file",
    "sort_order": 1,
    "is_active": true,
    "created_at": "2025-11-06T17:07:21.679013",
    "updated_at": "2025-11-10T16:04:53.909401",
    "params": [
      {
        "name": "select_source_file",
        "label": "é€‰æ‹©æ•°æ®æºæ–‡ä»¶",
        "description": "",
        "type": "select_excelpath",
        "required": true,
        "defaultValue": "",
        "direction": 0,
        "apiUrl": "http://127.0.0.1:5001/api/datasource/all-options"
      }
    ]
  },
  {
    "id": "15d889a9-0147-4605-9b53-517434ea3ad8",
    "name": "è·å–åŒºåŸŸå†…æœ€å°è¡Œå·",
    "icon": "el-icon-aim",
    "description": "è·å–excelæŒ‡å®šåŒºåŸŸå†…ï¼Œæœ€å°è¡Œå·",
    "category_id": "data_operation",
    "python_script": "from openpyxl import load_workbook\nfrom openpyxl.utils import coordinate_to_tuple, get_column_letter\n\ndef get_current_region(filepath,sheetname, start_cell):\n    \"\"\"\n    æ¨¡æ‹Ÿ Excel çš„ Range.CurrentRegion\n    è¿”å› (min_row, max_row, min_col, max_col)\n    \"\"\"\n    wb = load_workbook(filepath)\n    sheet = wb[sheetname]\n    if isinstance(start_cell, str):\n        start_row, start_col = coordinate_to_tuple(start_cell)\n    else:\n        start_row, start_col = start_cell\n\n    # åˆå§‹åŒ–åŒºåŸŸè¾¹ç•Œ\n    min_row = max_row = start_row\n    min_col = max_col = start_col\n\n    expanded = True\n    while expanded:\n        expanded = False\n\n        # å°è¯•å‘ä¸Šæ‰©å±•\n        if min_row > 1:\n            row = min_row - 1\n            # æ£€æŸ¥è¯¥è¡Œåœ¨ [min_col, max_col] èŒƒå›´å†…æ˜¯å¦å…¨ä¸ºç©º\n            if any(sheet.cell(row=row, column=col).value is not None for col in range(min_col, max_col + 1)):\n                min_row = row\n                expanded = True\n\n        # å°è¯•å‘ä¸‹æ‰©å±•\n        row = max_row + 1\n        if any(sheet.cell(row=row, column=col).value is not None for col in range(min_col, max_col + 1)):\n            max_row = row\n            expanded = True\n\n        # å°è¯•å‘å·¦æ‰©å±•\n        if min_col > 1:\n            col = min_col - 1\n            if any(sheet.cell(row=row, column=col).value is not None for row in range(min_row, max_row + 1)):\n                min_col = col\n                expanded = True\n\n        # å°è¯•å‘å³æ‰©å±•\n        col = max_col + 1\n        if any(sheet.cell(row=row, column=col).value is not None for row in range(min_row, max_row + 1)):\n            max_col = col\n            expanded = True\n\n    return min_row",
    "sort_order": 5,
    "is_active": true,
    "created_at": "2025-11-10T16:02:28.924133",
    "updated_at": "2025-11-10T16:18:41.441410",
    "params": [
      {
        "name": "filepath",
        "label": "æ–‡ä»¶è·¯å¾„",
        "description": "",
        "type": "string",
        "required": true,
        "defaultValue": "",
        "direction": 0,
        "apiUrl": ""
      },
      {
        "name": "sheetname",
        "label": "sheetåç§°",
        "description": "",
        "type": "string",
        "required": false,
        "defaultValue": "",
        "direction": 0,
        "apiUrl": ""
      },
      {
        "name": "start_cell",
        "label": "å•å…ƒæ ¼ä½ç½®",
        "description": "ç¤ºä¾‹ï¼šA3",
        "type": "string",
        "required": false,
        "defaultValue": "",
        "direction": 0,
        "apiUrl": ""
      },
      {
        "name": "min_row",
        "label": "è¾“å‡ºæœ€å°è¡Œå·",
        "description": "",
        "type": "string",
        "required": false,
        "defaultValue": "",
        "direction": 1,
        "apiUrl": ""
      }
    ]
  },
  {
    "id": "15d889a9-0147-4605-9b53-517434ea3ad5",
    "name": "è·å–åŒºåŸŸå†…æœ€å¤§è¡Œå·",
    "icon": "el-icon-aim",
    "description": "è·å–excelæŒ‡å®šåŒºåŸŸå†…ï¼Œæœ€å¤§è¡Œå·",
    "category_id": "data_operation",
    "python_script": "from openpyxl import load_workbook\nfrom openpyxl.utils import coordinate_to_tuple, get_column_letter\n\ndef get_current_region(filepath,sheetname, start_cell):\n    \"\"\"\n    æ¨¡æ‹Ÿ Excel çš„ Range.CurrentRegion\n    è¿”å› (min_row, max_row, min_col, max_col)\n    \"\"\"\n    wb = load_workbook(filepath)\n    sheet = wb[sheetname]\n    if isinstance(start_cell, str):\n        start_row, start_col = coordinate_to_tuple(start_cell)\n    else:\n        start_row, start_col = start_cell\n\n    # åˆå§‹åŒ–åŒºåŸŸè¾¹ç•Œ\n    min_row = max_row = start_row\n    min_col = max_col = start_col\n\n    expanded = True\n    while expanded:\n        expanded = False\n\n        # å°è¯•å‘ä¸Šæ‰©å±•\n        if min_row > 1:\n            row = min_row - 1\n            # æ£€æŸ¥è¯¥è¡Œåœ¨ [min_col, max_col] èŒƒå›´å†…æ˜¯å¦å…¨ä¸ºç©º\n            if any(sheet.cell(row=row, column=col).value is not None for col in range(min_col, max_col + 1)):\n                min_row = row\n                expanded = True\n\n        # å°è¯•å‘ä¸‹æ‰©å±•\n        row = max_row + 1\n        if any(sheet.cell(row=row, column=col).value is not None for col in range(min_col, max_col + 1)):\n            max_row = row\n            expanded = True\n\n        # å°è¯•å‘å·¦æ‰©å±•\n        if min_col > 1:\n            col = min_col - 1\n            if any(sheet.cell(row=row, column=col).value is not None for row in range(min_row, max_row + 1)):\n                min_col = col\n                expanded = True\n\n        # å°è¯•å‘å³æ‰©å±•\n        col = max_col + 1\n        if any(sheet.cell(row=row, column=col).value is not None for row in range(min_row, max_row + 1)):\n            max_col = col\n            expanded = True\n\n    return max_row",
    "sort_order": 6,
    "is_active": true,
    "created_at": "2025-11-10T16:02:28.924133",
    "updated_at": "2025-11-10T16:19:04.208033",
    "params": [
      {
        "name": "filepath",
        "label": "æ–‡ä»¶è·¯å¾„",
        "description": "",
        "type": "string",
        "required": true,
        "defaultValue": "",
        "direction": 0,
        "apiUrl": ""
      },
      {
        "name": "sheetname",
        "label": "sheetåç§°",
        "description": "",
        "type": "string",
        "required": false,
        "defaultValue": "",
        "direction": 0,
        "apiUrl": ""
      },
      {
        "name": "start_cell",
        "label": "å•å…ƒæ ¼ä½ç½®",
        "description": "ç¤ºä¾‹ï¼šA3",
        "type": "string",
        "required": false,
        "defaultValue": "",
        "direction": 0,
        "apiUrl": ""
      },
      {
        "name": "max_row",
        "label": "è¾“å‡ºæœ€å¤§è¡Œå·",
        "description": "",
        "type": "string",
        "required": false,
        "defaultValue": "",
        "direction": 1,
        "apiUrl": ""
      }
    ]
  },
  {
    "id": "15d889a9-0147-4605-9b53-517434ea3ad6",
    "name": "è·å–åŒºåŸŸå†…æœ€å°åˆ—å·",
    "icon": "el-icon-aim",
    "description": "è·å–excelæŒ‡å®šåŒºåŸŸå†…ï¼Œæœ€å°åˆ—å·",
    "category_id": "data_operation",
    "python_script": "from openpyxl import load_workbook\nfrom openpyxl.utils import coordinate_to_tuple, get_column_letter\n\ndef get_current_region(filepath,sheetname, start_cell):\n    \"\"\"\n    æ¨¡æ‹Ÿ Excel çš„ Range.CurrentRegion\n    è¿”å› (min_row, max_row, min_col, max_col)\n    \"\"\"\n    wb = load_workbook(filepath)\n    sheet = wb[sheetname]\n    if isinstance(start_cell, str):\n        start_row, start_col = coordinate_to_tuple(start_cell)\n    else:\n        start_row, start_col = start_cell\n\n    # åˆå§‹åŒ–åŒºåŸŸè¾¹ç•Œ\n    min_row = max_row = start_row\n    min_col = max_col = start_col\n\n    expanded = True\n    while expanded:\n        expanded = False\n\n        # å°è¯•å‘ä¸Šæ‰©å±•\n        if min_row > 1:\n            row = min_row - 1\n            # æ£€æŸ¥è¯¥è¡Œåœ¨ [min_col, max_col] èŒƒå›´å†…æ˜¯å¦å…¨ä¸ºç©º\n            if any(sheet.cell(row=row, column=col).value is not None for col in range(min_col, max_col + 1)):\n                min_row = row\n                expanded = True\n\n        # å°è¯•å‘ä¸‹æ‰©å±•\n        row = max_row + 1\n        if any(sheet.cell(row=row, column=col).value is not None for col in range(min_col, max_col + 1)):\n            max_row = row\n            expanded = True\n\n        # å°è¯•å‘å·¦æ‰©å±•\n        if min_col > 1:\n            col = min_col - 1\n            if any(sheet.cell(row=row, column=col).value is not None for row in range(min_row, max_row + 1)):\n                min_col = col\n                expanded = True\n\n        # å°è¯•å‘å³æ‰©å±•\n        col = max_col + 1\n        if any(sheet.cell(row=row, column=col).value is not None for row in range(min_row, max_row + 1)):\n            max_col = col\n            expanded = True\n\n    return get_column_letter(min_col)",
    "sort_order": 7,
    "is_active": true,
    "created_at": "2025-11-10T16:02:28.924133",
    "updated_at": "2025-11-10T16:19:27.902987",
    "params": [
      {
        "name": "filepath",
        "label": "æ–‡ä»¶è·¯å¾„",
        "description": "",
        "type": "string",
        "required": true,
        "defaultValue": "",
        "direction": 0,
        "apiUrl": ""
      },
      {
        "name": "sheetname",
        "label": "sheetåç§°",
        "description": "",
        "type": "string",
        "required": false,
        "defaultValue": "",
        "direction": 0,
        "apiUrl": ""
      },
      {
        "name": "start_cell",
        "label": "å•å…ƒæ ¼ä½ç½®",
        "description": "ç¤ºä¾‹ï¼šA3",
        "type": "string",
        "required": false,
        "defaultValue": "",
        "direction": 0,
        "apiUrl": ""
      },
      {
        "name": "min_col",
        "label": "è¾“å‡ºæœ€å°åˆ—å·",
        "description": "",
        "type": "string",
        "required": false,
        "defaultValue": "",
        "direction": 1,
        "apiUrl": ""
      }
    ]
  },
  {
    "id": "15d889a9-0147-4605-9b53-517434ea3ad7",
    "name": "è·å–åŒºåŸŸå†…æœ€å¤§åˆ—å·",
    "icon": "el-icon-aim",
    "description": "è·å–excelæŒ‡å®šåŒºåŸŸå†…ï¼Œæœ€å¤§åˆ—å·",
    "category_id": "data_operation",
    "python_script": "from openpyxl import load_workbook\nfrom openpyxl.utils import coordinate_to_tuple, get_column_letter\n\ndef get_current_region(filepath,sheetname, start_cell):\n    \"\"\"\n    æ¨¡æ‹Ÿ Excel çš„ Range.CurrentRegion\n    è¿”å› (min_row, max_row, min_col, max_col)\n    \"\"\"\n    wb = load_workbook(filepath)\n    sheet = wb[sheetname]\n    if isinstance(start_cell, str):\n        start_row, start_col = coordinate_to_tuple(start_cell)\n    else:\n        start_row, start_col = start_cell\n\n    # åˆå§‹åŒ–åŒºåŸŸè¾¹ç•Œ\n    min_row = max_row = start_row\n    min_col = max_col = start_col\n\n    expanded = True\n    while expanded:\n        expanded = False\n\n        # å°è¯•å‘ä¸Šæ‰©å±•\n        if min_row > 1:\n            row = min_row - 1\n            # æ£€æŸ¥è¯¥è¡Œåœ¨ [min_col, max_col] èŒƒå›´å†…æ˜¯å¦å…¨ä¸ºç©º\n            if any(sheet.cell(row=row, column=col).value is not None for col in range(min_col, max_col + 1)):\n                min_row = row\n                expanded = True\n\n        # å°è¯•å‘ä¸‹æ‰©å±•\n        row = max_row + 1\n        if any(sheet.cell(row=row, column=col).value is not None for col in range(min_col, max_col + 1)):\n            max_row = row\n            expanded = True\n\n        # å°è¯•å‘å·¦æ‰©å±•\n        if min_col > 1:\n            col = min_col - 1\n            if any(sheet.cell(row=row, column=col).value is not None for row in range(min_row, max_row + 1)):\n                min_col = col\n                expanded = True\n\n        # å°è¯•å‘å³æ‰©å±•\n        col = max_col + 1\n        if any(sheet.cell(row=row, column=col).value is not None for row in range(min_row, max_row + 1)):\n            max_col = col\n            expanded = True\n\n    return get_column_letter(max_col)",
    "sort_order": 8,
    "is_active": true,
    "created_at": "2025-11-10T16:02:28.924133",
    "updated_at": "2025-11-10T16:19:43.595964",
    "params": [
      {
        "name": "filepath",
        "label": "æ–‡ä»¶è·¯å¾„",
        "description": "",
        "type": "string",
        "required": true,
        "defaultValue": "",
        "direction": 0,
        "apiUrl": ""
      },
      {
        "name": "sheetname",
        "label": "sheetåç§°",
        "description": "",
        "type": "string",
        "required": false,
        "defaultValue": "",
        "direction": 0,
        "apiUrl": ""
      },
      {
        "name": "start_cell",
        "label": "å•å…ƒæ ¼ä½ç½®",
        "description": "ç¤ºä¾‹ï¼šA3",
        "type": "string",
        "required": false,
        "defaultValue": "",
        "direction": 0,
        "apiUrl": ""
      },
      {
        "name": "max_col",
        "label": "è¾“å‡ºæœ€å¤§åˆ—å·",
        "description": "",
        "type": "string",
        "required": false,
        "defaultValue": "",
        "direction": 1,
        "apiUrl": ""
      }
    ]
  },
  {
    "id": "6d867fef-eac7-4cf1-b9a5-3ad2ff7b024c",
    "name": "æŸ¥æ‰¾å•å…ƒæ ¼ä½ç½®",
    "icon": "el-icon-add-location",
    "description": "æŸ¥æ‰¾æŒ‡å®šå­—ç¬¦ä¸²åœ¨å•å…ƒæ ¼ä¸­çš„ä½ç½®",
    "category_id": "data_operation",
    "python_script": "from openpyxl import load_workbook\nfrom openpyxl.utils import get_column_letter\n\ndef find_exact_string_with_newline(file_path, sheet_name, target_string):\n    \"\"\"\n    åœ¨ Excel ä¸­ç²¾ç¡®æŸ¥æ‰¾åŒ…å«æ¢è¡Œç¬¦çš„ç›®æ ‡å­—ç¬¦ä¸²ã€‚\n    \n    :param file_path: Excel æ–‡ä»¶è·¯å¾„\n    :param sheet_name: å·¥ä½œè¡¨å\n    :param target_string: è¦æŸ¥æ‰¾çš„å­—ç¬¦ä¸²ï¼ˆå« \\n æ¢è¡Œï¼‰\n    :return: åŒ¹é…çš„å•å…ƒæ ¼åœ°å€åˆ—è¡¨\n    \"\"\"\n    wb = load_workbook(file_path, read_only=True)\n    ws = wb[sheet_name]\n    addr = ''\n\n    for row in ws.iter_rows():\n        for cell in row:\n            if cell.value is not None:\n                # å°†å€¼è½¬ä¸ºå­—ç¬¦ä¸²å¹¶å»é™¤å‰åç©ºç™½ï¼ˆå¯é€‰ï¼‰\n                val_str = str(cell.value).strip()\n                if val_str == target_string.strip():\n                    addr = f\"{get_column_letter(cell.column)}{cell.row}\"                \n            if addr:\n                break\n        if addr:\n            break\n    \n    wb.close()\n    return addr",
    "sort_order": 10,
    "is_active": true,
    "created_at": "2025-11-12T10:31:30.622412",
    "updated_at": "2025-11-12T10:53:33.278625",
    "params": [
      {
        "name": "file_path",
        "label": "æ–‡ä»¶è·¯å¾„",
        "description": "",
        "type": "string",
        "required": true,
        "defaultValue": "",
        "direction": 0,
        "apiUrl": ""
      },
      {
        "name": "sheet_name",
        "label": "sheetåç§°",
        "description": "",
        "type": "string",
        "required": true,
        "defaultValue": "",
        "direction": 0,
        "apiUrl": ""
      },
      {
        "name": "target_string",
        "label": "æŸ¥æ‰¾å­—ç¬¦ä¸²",
        "description": "",
        "type": "string",
        "required": true,
        "defaultValue": "",
        "direction": 0,
        "apiUrl": ""
      },
      {
        "name": "cell_address",
        "label": "å•å…ƒæ ¼ä½ç½®",
        "description": "å¦‚A3",
        "type": "string",
        "required": true,
        "defaultValue": "cell_address",
        "direction": 1,
        "apiUrl": ""
      }
    ]
  },
  {
    "id": "1e425d92-a796-4abd-8067-2c2488d89beb",
    "name": "è·å–ç‹¬ç«‹è¡¨æ ¼åŒºåŸŸ",
    "icon": "code",
    "description": "ä»excelæ–‡ä»¶æŒ‡å®šsheetä¸­è·å–æ‰€æœ‰ç‹¬ç«‹è¡¨æ ¼åŒºåŸŸé›†åˆ",
    "category_id": "data_operation",
    "python_script": "from openpyxl import load_workbook\nfrom openpyxl.utils import get_column_letter\nfrom collections import deque\n\ndef get_independent_table_regions(file_path, sheet_name):\n    \"\"\"\n    ä½¿ç”¨å››è¿é€šï¼ˆä¸Šä¸‹å·¦å³ï¼‰æ£€æµ‹æ‰€æœ‰ç‹¬ç«‹è¡¨æ ¼åŒºåŸŸã€‚\n    å³ä½¿ä¸¤ä¸ªåŒºåŸŸåœ¨åŒä¸€è¡ŒèŒƒå›´ï¼Œåªè¦è¢«ç©ºåˆ—éš”å¼€ï¼Œå°±è§†ä¸ºç‹¬ç«‹ã€‚\n    \n    è¿”å›: [(min_row, min_col, max_row, max_col), ...]\n    \"\"\"\n    wb = load_workbook(file_path, read_only=False)\n    ws = wb[sheet_name]\n\n    # æ„å»ºéç©ºå•å…ƒæ ¼é›†åˆ\n    non_empty = set()\n    for row in ws.iter_rows():\n        for cell in row:\n            if cell.value is not None:\n                non_empty.add((cell.row, cell.column))\n\n    visited = set()\n    regions = []\n\n    # å››ä¸ªæ–¹å‘ï¼šä¸Šã€ä¸‹ã€å·¦ã€å³\n    directions = [(-1, 0), (1, 0), (0, -1), (0, 1)]\n\n    for start in non_empty:\n        if start in visited:\n            continue\n\n        # BFS å¼€å§‹\n        queue = deque([start])\n        component = set()\n        component.add(start)\n        visited.add(start)\n\n        while queue:\n            r, c = queue.popleft()\n            for dr, dc in directions:\n                nr, nc = r + dr, c + dc\n                neighbor = (nr, nc)\n                if neighbor in non_empty and neighbor not in visited:\n                    visited.add(neighbor)\n                    component.add(neighbor)\n                    queue.append(neighbor)\n\n        # è®¡ç®—è¯¥è¿é€šåŒºåŸŸçš„è¾¹ç•Œ\n        rows = [p[0] for p in component]\n        cols = [p[1] for p in component]\n        min_r, max_r = min(rows), max(rows)\n        min_c, max_c = min(cols), max(cols)\n\n        regions.append(f\"{get_column_letter(min_c)}{min_r}:{get_column_letter(max_c)}{max_r}\")\n\n    wb.close()\n    # å¯é€‰ï¼šæŒ‰åŒºåŸŸå·¦ä¸Šè§’æ’åºï¼ˆä»ä¸Šåˆ°ä¸‹ã€ä»å·¦åˆ°å³ï¼‰\n    regions.sort(key=lambda x: (x[0], x[1]))\n    return regions",
    "sort_order": 11,
    "is_active": true,
    "created_at": "2025-11-12T14:22:15.542710",
    "updated_at": "2025-11-12T14:22:15.542710",
    "params": [
      {
        "name": "file_path",
        "label": "æ–‡ä»¶è·¯å¾„",
        "description": "",
        "type": "string",
        "required": false,
        "defaultValue": "",
        "direction": 0,
        "apiUrl": ""
      },
      {
        "name": "sheet_name",
        "label": "sheetåç§°",
        "description": "",
        "type": "string",
        "required": false,
        "defaultValue": "",
        "direction": 0,
        "apiUrl": ""
      },
      {
        "name": "regions",
        "label": "è¡¨æ ¼åŒºåŸŸé›†åˆ",
        "description": "",
        "type": "string",
        "required": false,
        "defaultValue": "",
        "direction": 1,
        "apiUrl": ""
      }
    ]
  },
  {
    "id": "6ce5e09a-2ad1-4dca-9f07-fbfa7f89faed",
    "name": "è·å–é›†åˆé•¿åº¦",
    "icon": "code",
    "description": "è·å–é›†åˆå˜é‡é•¿åº¦",
    "category_id": "flow_control",
    "python_script": "import ast\ndef execute(data_list):  \n    # å®‰å…¨åœ°å°†å­—ç¬¦ä¸²è½¬ä¸ºåˆ—è¡¨\n    region_list = ast.literal_eval(data_list)\n    return len(region_list)",
    "sort_order": 3,
    "is_active": true,
    "created_at": "2025-11-12T14:25:29.514329",
    "updated_at": "2025-11-12T15:44:20.675059",
    "params": [
      {
        "name": "data_list",
        "label": "æ•°æ®é›†åˆ",
        "description": "",
        "type": "string",
        "required": false,
        "defaultValue": "",
        "direction": 0,
        "apiUrl": ""
      },
      {
        "name": "data_len",
        "label": "æ•°æ®é•¿åº¦",
        "description": "",
        "type": "string",
        "required": false,
        "defaultValue": "",
        "direction": 1,
        "apiUrl": ""
      }
    ]
  },
  {
    "id": "d906386f-83d4-4ee5-a6ac-df8cdfaa5078",
    "name": "é›†åˆå–ç¬¬nä¸ªå€¼",
    "icon": "code",
    "description": "ä»é›†åˆä¸­å–ç¬¬nä¸ªå€¼",
    "category_id": "flow_control",
    "python_script": "import ast\ndef execute(data_list,n):\n    # å®‰å…¨åœ°å°†å­—ç¬¦ä¸²è½¬ä¸ºåˆ—è¡¨\n    region_list = ast.literal_eval(data_list)\n    return region_list[int(n)]",
    "sort_order": 2,
    "is_active": true,
    "created_at": "2025-11-12T14:32:46.136719",
    "updated_at": "2025-11-12T15:45:56.968763",
    "params": [
      {
        "name": "data_list",
        "label": "æ•°æ®é›†åˆ",
        "description": "",
        "type": "string",
        "required": false,
        "defaultValue": "",
        "direction": 0,
        "apiUrl": ""
      },
      {
        "name": "n",
        "label": "å–ç¬¬å‡ ä¸ªå€¼",
        "description": "",
        "type": "string",
        "required": false,
        "defaultValue": "",
        "direction": 0,
        "apiUrl": ""
      },
      {
        "name": "value",
        "label": "å€¼",
        "description": "",
        "type": "string",
        "required": false,
        "defaultValue": "",
        "direction": 1,
        "apiUrl": ""
      }
    ]
  },
  {
    "id": "35a6cb18-fc40-4999-9e19-d6b119ea4736",
    "name": "æ•°æ®èŒƒå›´æå–",
    "icon": "code",
    "description": "ä»excelæ–‡ä»¶æŒ‡å®šåŒºåŸŸä¸­æå–æ•°æ®",
    "category_id": "data_operation",
    "python_script": "import openpyxl\nfrom openpyxl.styles import Font, Border, PatternFill, Alignment\nfrom openpyxl.utils import column_index_from_string, get_column_letter\nfrom openpyxl.worksheet.worksheet import Worksheet\nimport os\nimport re\nfrom openpyxl.styles.colors import COLOR_INDEX\n\n# ========== è¾…åŠ©å‡½æ•°ï¼šé¢œè‰²è§£æ ==========\ndef _theme_and_tint_to_rgb(theme, tint, workbook):\n    \"\"\"å°† Excel ä¸»é¢˜è‰² + è‰²è°ƒè½¬æ¢ä¸º ARGB å­—ç¬¦ä¸²ï¼ˆå¦‚ 'FF00FF00'ï¼‰\"\"\"\n    try:\n        clr_scheme = workbook.theme.themeElements.clrScheme\n        # æ˜ å°„ theme ç´¢å¼•åˆ° clrScheme å±æ€§\n        theme_colors = [\n            clr_scheme.lt1.val,   # 0: Light 1 (usually white)\n            clr_scheme.dk1.val,   # 1: Dark 1 (usually black)\n            clr_scheme.lt2.val,   # 2: Light 2\n            clr_scheme.dk2.val,   # 3: Dark 2\n            clr_scheme.accent1.val,\n            clr_scheme.accent2.val,\n            clr_scheme.accent3.val,\n            clr_scheme.accent4.val,\n            clr_scheme.accent5.val,\n            clr_scheme.accent6.val,\n        ]\n        if theme < len(theme_colors):\n            base_rgb = theme_colors[theme]\n        else:\n            return None\n\n        # éªŒè¯ base_rgb æ˜¯ 6 ä½åå…­è¿›åˆ¶\n        if not base_rgb or not re.match(r'^[0-9A-Fa-f]{6}$', base_rgb):\n            return None\n\n        # åº”ç”¨ tintï¼ˆè‰²è°ƒè°ƒæ•´ï¼‰\n        def apply_tint(rgb_hex, tint_value):\n            r = int(rgb_hex[0:2], 16)\n            g = int(rgb_hex[2:4], 16)\n            b = int(rgb_hex[4:6], 16)\n\n            if tint_value < 0:\n                # Darken\n                r = int(r * (1 + tint_value))\n                g = int(g * (1 + tint_value))\n                b = int(b * (1 + tint_value))\n            else:\n                # Lighten\n                r = int(r * (1 - tint_value) + 255 * tint_value)\n                g = int(g * (1 - tint_value) + 255 * tint_value)\n                b = int(b * (1 - tint_value) + 255 * tint_value)\n\n            r = max(0, min(255, r))\n            g = max(0, min(255, g))\n            b = max(0, min(255, b))\n            return f\"{r:02X}{g:02X}{b:02X}\"\n\n        rgb = apply_tint(base_rgb, tint)\n        return f\"FF{rgb}\".upper()  # Alpha=FF (ä¸é€æ˜)\n    except Exception:\n        return None\n\n\ndef _get_rgb_color(color_obj, workbook=None):\n    \"\"\"å®‰å…¨è·å–é¢œè‰²çš„ ARGB å­—ç¬¦ä¸²è¡¨ç¤º\"\"\"\n    if color_obj is None:\n        return None\n\n    if hasattr(color_obj, 'type'):\n        if color_obj.type == 'rgb' and color_obj.rgb:\n            return color_obj.rgb  # already like 'FF0000FF'\n        elif color_obj.type == 'theme' and workbook is not None:\n            tint = getattr(color_obj, 'tint', 0.0)\n            return _theme_and_tint_to_rgb(color_obj.theme, tint, workbook)\n        elif color_obj.type == 'indexed':\n            idx = color_obj.indexed\n            if isinstance(idx, int) and 0 <= idx < len(COLOR_INDEX):\n                val = COLOR_INDEX[idx]\n                if val and isinstance(val, str) and len(val) == 6:\n                    return f\"FF{val}\".upper()\n    return None\nfrom openpyxl.utils import column_index_from_string, coordinate_to_tuple\ndef _parse_range(range_str):\n    \"\"\"\n    å°† Excel åŒºåŸŸå­—ç¬¦ä¸²ï¼ˆå¦‚ 'A3:B5'ï¼‰è§£æä¸ºå­—å…¸ï¼š\n    {\n        \"startRow\": 3,\n        \"endRow\": 5,\n        \"startColumn\": \"A\",\n        \"endColumn\": \"B\"\n    }\n    \"\"\"\n    if ':' not in range_str:\n        # å•ä¸ªå•å…ƒæ ¼ï¼Œå¦‚ 'C7'\n        cell = range_str.strip()\n        row, col = coordinate_to_tuple(cell)\n        col_letter = cell[:len(cell) - len(str(row))]\n        return {\n            \"startRow\": row,\n            \"endRow\": row,\n            \"startColumn\": col_letter.upper(),\n            \"endColumn\": col_letter.upper()\n        }\n    \n    start_cell, end_cell = range_str.split(':')\n    start_cell = start_cell.strip()\n    end_cell = end_cell.strip()\n\n    # è§£æèµ·å§‹å’Œç»“æŸå•å…ƒæ ¼\n    start_row, start_col_idx = coordinate_to_tuple(start_cell)\n    end_row, end_col_idx = coordinate_to_tuple(end_cell)\n\n    # è·å–åˆ—å­—æ¯ï¼ˆä¿æŒåŸå§‹å¤§å°å†™æˆ–ç»Ÿä¸€è½¬å¤§å†™ï¼‰\n    start_col_letter = start_cell[:len(start_cell) - len(str(start_row))].upper()\n    end_col_letter = end_cell[:len(end_cell) - len(str(end_row))].upper()\n\n    return start_row,end_row,start_col_letter,end_col_letter\n\n# ========== ä¸»å‡½æ•° ==========\ndef read_excel_range(\n    datasPath: str = None,\n    sheetName: str = None,\n    range_str: str = None\n):\n    \"\"\"\n    è¯»å– Excel æŒ‡å®šåŒºåŸŸå•å…ƒæ ¼çš„æ•°æ®å’Œæ ·å¼ï¼ˆå«æ­£ç¡®è§£æçš„èƒŒæ™¯è‰²ï¼‰ã€‚\n\n    å‚æ•°:\n        datasPath (str, optional): Excel æ–‡ä»¶è·¯å¾„ã€‚é»˜è®¤ä¸º Noneã€‚\n        sheetName (str, optional): å·¥ä½œè¡¨åç§°ã€‚é»˜è®¤ä¸º None (è¯»å–æ´»åŠ¨å·¥ä½œè¡¨æˆ–ç¬¬ä¸€ä¸ªå·¥ä½œè¡¨)ã€‚\n        range_str (str, optional): åŒºåŸŸå­—ç¬¦ä¸²ï¼Œå¦‚ 'A3:B5'ã€‚é»˜è®¤ä¸º None (è¯»å–æ•´ä¸ªå·¥ä½œè¡¨)ã€‚\n\n    è¿”å›:\n        list: åŒ…å«å•å…ƒæ ¼ä¿¡æ¯çš„åˆ—è¡¨ï¼Œæ¯ä¸ªå•å…ƒæ ¼ä¿¡æ¯æ˜¯ä¸€ä¸ªå­—å…¸ï¼Œ\n              åŒ…å« 'value', 'font', 'border', 'fill', 'alignment' ç­‰é”®ã€‚\n              å¦‚æœå‘ç”Ÿé”™è¯¯ï¼Œåˆ™è¿”å› Noneã€‚\n    \"\"\"\n    if not datasPath:\n        print(\"é”™è¯¯: å¿…é¡»æä¾› datasPath å‚æ•°ã€‚\")\n        return None\n\n    if not os.path.exists(datasPath):\n        print(f\"é”™è¯¯: æ–‡ä»¶è·¯å¾„ '{datasPath}' ä¸å­˜åœ¨ã€‚\")\n        return None\n\n    try:\n        workbook = openpyxl.load_workbook(datasPath, data_only=True)\n    except Exception as e:\n        print(f\"é”™è¯¯: æ— æ³•åŠ è½½å·¥ä½œç°¿ '{datasPath}'ã€‚åŸå› : {e}\")\n        return None\n\n    # è·å–å·¥ä½œè¡¨\n    worksheet = None\n    if sheetName:\n        if sheetName in workbook.sheetnames:\n            worksheet = workbook[sheetName]\n        else:\n            print(f\"è­¦å‘Š: å·¥ä½œè¡¨ '{sheetName}' æœªæ‰¾åˆ°ï¼Œå°†ä½¿ç”¨æ´»åŠ¨å·¥ä½œè¡¨æˆ–ç¬¬ä¸€ä¸ªå·¥ä½œè¡¨ã€‚\")\n\n    if worksheet is None:\n        worksheet = workbook.active if workbook.active else (workbook.worksheets[0] if workbook.worksheets else None)\n        if worksheet is None:\n            print(\"é”™è¯¯: å·¥ä½œç°¿ä¸­æ²¡æœ‰å¯ç”¨çš„å·¥ä½œè¡¨ã€‚\")\n            return None\n        else:\n            print(f\"ä¿¡æ¯: ä½¿ç”¨å·¥ä½œè¡¨ '{worksheet.title}'.\")\n    startRow,endRow,startColumn,endColumn = _parse_range(range_str)\n    # è·å–å®é™…ç»´åº¦\n    max_row = worksheet.max_row\n    max_column = worksheet.max_column\n\n    # å¤„ç†é»˜è®¤å€¼\n    startRow = max(1, startRow or 1)\n    endRow = min(max_row, endRow or max_row)\n\n    def safe_col_index(col_str):\n        if col_str is None:\n            return 1\n        try:\n            return column_index_from_string(col_str.upper())\n        except:\n            print(f\"è­¦å‘Š: åˆ—å· '{col_str}' æ— æ•ˆï¼Œå°†ä½¿ç”¨é»˜è®¤åˆ—ã€‚\")\n            return 1\n\n    startColIndex = max(1, safe_col_index(startColumn))\n    endColIndex = min(max_column, safe_col_index(endColumn) if endColumn else max_column)\n\n    if startRow > endRow or startColIndex > endColIndex:\n        print(\"è­¦å‘Š: æŒ‡å®šçš„èŒƒå›´æ— æ•ˆ (èµ·å§‹ä½ç½®å¤§äºç»“æŸä½ç½®)ï¼Œå°†è¿”å›ç©ºåˆ—è¡¨ã€‚\")\n        return []\n\n    print(f\"ä¿¡æ¯: æ­£åœ¨è¯»å–èŒƒå›´ {get_column_letter(startColIndex)}{startRow}:{get_column_letter(endColIndex)}{endRow}...\")\n\n    result_data = []\n\n    for row in range(startRow, endRow + 1):\n        row_data = []\n        for col in range(startColIndex, endColIndex + 1):\n            cell = worksheet.cell(row=row, column=col)\n\n            # æå–å­—ä½“é¢œè‰²ï¼ˆå¯é€‰æ‰©å±•ï¼‰\n            font_color_rgb = _get_rgb_color(cell.font.color, workbook) if cell.font else None\n\n            cell_info = {\n                \"coordinate\": cell.coordinate,\n                \"value\": cell.value,\n                \"font\": {\n                    \"name\": cell.font.name if cell.font else None,\n                    \"sz\": cell.font.sz if cell.font else None,\n                    \"colorRGB\": font_color_rgb,\n                    \"b\": cell.font.b if cell.font else None,\n                    \"i\": cell.font.i if cell.font else None,  # italic\n                    \"u\": cell.font.u if cell.font else None,  # underline\n                },\n                \"border\": {\n                    \"left\": {\n                        \"style\": cell.border.left.style if cell.border and cell.border.left else None,\n                        \"colorRGB\": _get_rgb_color(cell.border.left.color, workbook) if cell.border and cell.border.left else None,\n                    },\n                    \"right\": {\n                        \"style\": cell.border.right.style if cell.border and cell.border.right else None,\n                        \"colorRGB\": _get_rgb_color(cell.border.right.color, workbook) if cell.border and cell.border.right else None,\n                    },\n                    \"top\": {\n                        \"style\": cell.border.top.style if cell.border and cell.border.top else None,\n                        \"colorRGB\": _get_rgb_color(cell.border.top.color, workbook) if cell.border and cell.border.top else None,\n                    },\n                    \"bottom\": {\n                        \"style\": cell.border.bottom.style if cell.border and cell.border.bottom else None,\n                        \"colorRGB\": _get_rgb_color(cell.border.bottom.color, workbook) if cell.border and cell.border.bottom else None,\n                    },\n                },\n                \"fill\": {\n                    \"patternType\": cell.fill.patternType if cell.fill else None,\n                    \"fgColorRGB\": _get_rgb_color(cell.fill.fgColor, workbook) if cell.fill else None,\n                    \"bgColorRGB\": _get_rgb_color(cell.fill.bgColor, workbook) if cell.fill else None,\n                },\n                \"alignment\": {\n                    \"horizontal\": cell.alignment.horizontal if cell.alignment else None,\n                    \"vertical\": cell.alignment.vertical if cell.alignment else None,\n                    \"wrap_text\": cell.alignment.wrapText if cell.alignment else None,\n                    \"text_rotation\": cell.alignment.textRotation if cell.alignment else None,\n                }\n            }\n            row_data.append(cell_info)\n        result_data.append(row_data)\n\n    return result_data",
    "sort_order": 1,
    "is_active": true,
    "created_at": "2025-11-12T15:01:36.226130",
    "updated_at": "2025-11-13T11:03:44.710655",
    "params": [
      {
        "name": "datasPath",
        "label": "æ–‡ä»¶è·¯å¾„",
        "description": "",
        "type": "string",
        "required": false,
        "defaultValue": "",
        "direction": 0,
        "apiUrl": ""
      },
      {
        "name": "sheetName",
        "label": "sheetåç§°",
        "description": "",
        "type": "string",
        "required": false,
        "defaultValue": "",
        "direction": 0,
        "apiUrl": ""
      },
      {
        "name": "range_str",
        "label": "æ•°æ®åŒºåŸŸ",
        "description": "",
        "type": "string",
        "required": false,
        "defaultValue": "",
        "direction": 0,
        "apiUrl": ""
      },
      {
        "name": "result_data",
        "label": "æ•°æ®ç»“æœ",
        "description": "",
        "type": "string",
        "required": false,
        "defaultValue": "",
        "direction": 1,
        "apiUrl": ""
      }
    ]
  },
  {
    "id": "4c7284d8-f782-4fc9-aaf8-7f642f1f69a7",
    "name": "è®¾ç½®å˜é‡",
    "icon": "code",
    "description": "æ–°å»ºæˆ–æ›´æ–°å˜é‡",
    "category_id": "flow_control",
    "python_script": "def execute(value):    \n    return value",
    "sort_order": 1,
    "is_active": true,
    "created_at": "2025-11-12T15:09:11.527239",
    "updated_at": "2025-11-12T17:12:12.554883",
    "params": [
      {
        "name": "value",
        "label": "å˜é‡å€¼",
        "description": "",
        "type": "string",
        "required": false,
        "defaultValue": "",
        "direction": 0,
        "apiUrl": ""
      },
      {
        "name": "name",
        "label": "å˜é‡å",
        "description": "",
        "type": "string",
        "required": false,
        "defaultValue": "",
        "direction": 2,
        "apiUrl": ""
      }
    ]
  },
  {
    "id": "1425726d-630e-41e2-b9c9-8666f676a1a0",
    "name": "æ·»åŠ sheeté¡µ",
    "icon": "code",
    "description": "å‘excelä¸­æ·»åŠ sheeté¡µ",
    "category_id": "data_operation",
    "python_script": "import os\nimport re\nfrom openpyxl import load_workbook\n\ndef _sanitize_sheet_name(name: str, existing_names) -> str:\n    name = str(name).strip() if name else \"\"\n    name = re.sub(r'[^\\u4e00-\\u9fa5a-zA-Z0-9]', '_', name)\n    name = name[:31].rstrip('_') or \"Sheet\"\n    candidate = name\n    counter = 1\n    while candidate in existing_names:\n        suffix = f\" ({counter})\"\n        base = name[:31 - len(suffix)]\n        candidate = base + suffix\n        counter += 1\n    print(f\"æœ€ç»ˆå·¥ä½œè¡¨å: {candidate}\")\n    return candidate\n\ndef add_sheet_to_existing_excel(file_path: str, sheet_name: str):\n    if not os.path.isfile(file_path):\n        raise FileNotFoundError(f\"æ–‡ä»¶ä¸å­˜åœ¨: {file_path}\")\n    \n    wb = load_workbook(file_path)\n    existing = wb.sheetnames\n\n    clean_name = _sanitize_sheet_name(sheet_name, existing)\n    if sheet_name not in existing:\n        wb.create_sheet(title=clean_name)\n        wb.save(file_path)\n    wb.close()",
    "sort_order": 1,
    "is_active": true,
    "created_at": "2025-11-12T15:38:34.329489",
    "updated_at": "2025-11-12T17:39:05.491356",
    "params": [
      {
        "name": "file_path",
        "label": "æ–‡ä»¶è·¯å¾„",
        "description": "",
        "type": "string",
        "required": false,
        "defaultValue": "",
        "direction": 0,
        "apiUrl": ""
      },
      {
        "name": "sheet_name",
        "label": "sheetåç§°",
        "description": "",
        "type": "string",
        "required": false,
        "defaultValue": "",
        "direction": 0,
        "apiUrl": ""
      }
    ]
  }
]